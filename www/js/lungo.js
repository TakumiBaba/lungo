// Generated by CoffeeScript 1.6.3
(function() {
  var generateLi, linda, reloadList, ts,
    _this = this;

  linda = new Linda();

  ts = new linda.TupleSpace("stock");

  linda.io.on("connect", function() {
    return ts.read([], function(tuple) {
      reloadList(tuple);
      return ts.watch([], reloadList);
    });
  });

  reloadList = function(tuple) {
    var key, li, ul, value, _ref;
    ul = $("#list");
    ul.empty();
    _ref = tuple[0];
    for (key in _ref) {
      value = _ref[key];
      console.log(key, value.stock);
      if (value.stock > 0) {
        continue;
      }
      li = generateLi(key, value);
      ul.append(li);
    }
    ul.listview("refresh");
    return ul.children().each(function() {
      return $(this).find("a").removeClass("ui-icon-carat-r");
    });
  };

  generateLi = function(key, value) {
    var a, li, name,
      _this = this;
    name = "";
    if (value.name === "") {
      name = key;
    } else {
      name = value.name;
    }
    li = $("<li>").attr("data-theme", "c");
    a = $("<a>");
    name = $("<span>").addClass("ui-btn-text").html("" + name + "　がない！");
    li.append($("<a>").append(name));
    li.bind("click", function() {
      return ts.take([], function(tuple) {
        var v;
        console.log(tuple);
        v = tuple[0];
        v[key].stock = 10;
        return ts.write([v]);
      });
    });
    return li;
  };

}).call(this);
